<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>MikuSugar - é«˜æ•ˆå¯¼èˆª</title>
    <link rel="shortcut icon" href="../assets/images/favicon.png">

    <style>
        /* ============================================== */
        /* é»˜è®¤ä¸»é¢˜ (æµ…è‰²æ¨¡å¼ Light Mode) */
        /* ============================================== */
        :root {
            --bg-body: #FFFFFF; /* æ•´ä½“èƒŒæ™¯ */
            --bg-container: #F7F7F9; /* ä¾§è¾¹æ /å¡ç‰‡èƒŒæ™¯ */
            --bg-tertiary: #E8E8EC; /* è¾“å…¥æ¡†/æ‚¬åœèƒŒæ™¯ */
            --text-primary: #1d1d1f;
            --text-muted: #6a6a6a;
            --accent-color: #5d5dff;
            --shadow-base: rgba(0, 0, 0, 0.1);
            --shadow-hover: rgba(0, 0, 0, 0.2);
        }

        /* ============================================== */
        /* å¼ºåˆ¶æ·±è‰²æ¨¡å¼ (Dark Mode Override) */
        /* ============================================== */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-body: #1e1e2f;
                --bg-container: #27293d;
                --bg-tertiary: #30314a;
                --text-primary: #f0f0f0;
                --text-muted: #a0a0b0;
                --shadow-base: rgba(0, 0, 0, 0.4);
                --shadow-hover: rgba(0, 0, 0, 0.6);
            }
        }

        /* é€šç”¨æ ·å¼ */
        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Microsoft YaHei", sans-serif;
            transition: color 0.2s, background-color 0.3s, box-shadow 0.3s, transform 0.3s;
        }

        body {
            margin: 0;
            background-color: var(--bg-body);
            color: var(--text-primary);
            display: flex;
            height: 100vh;
            overflow: hidden;
            --sidebar-width: 250px;
        }

        /* --- 1. å›ºå®šä¾§è¾¹æ  --- */
        .sidebar {
            width: var(--sidebar-width);
            flex-shrink: 0;
            padding: 20px 0;
            background-color: var(--bg-container);
            overflow-y: auto;
            box-shadow: 4px 0 10px var(--shadow-base);
        }

        .logo-area {
            font-size: 24px;
            font-weight: 700;
            padding: 0 20px 20px 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--bg-tertiary);
        }
        .logo-area img {
            width: 32px;
            height: 32px;
            margin-right: 10px;
        }

        .menu-list { list-style: none; padding: 0; }

        .menu-link {
            display: block;
            padding: 12px 20px;
            margin: 4px 10px;
            text-decoration: none;
            color: var(--text-muted);
            font-size: 15px;
            border-radius: 10px;
        }

        .menu-link:hover {
            color: var(--text-primary);
            background-color: var(--bg-tertiary);
        }
        .menu-link.active {
            color: white; /* å¼ºè°ƒè‰²ä¸‹çš„æ–‡å­—å›ºå®šä¸ºç™½è‰² */
            background-color: var(--accent-color);
            box-shadow: 0 4px 8px rgba(93, 93, 255, 0.4);
        }

        /* --- 2. ä¸»å†…å®¹åŒºåŸŸ --- */
        .main-content-wrapper {
            flex-grow: 1;
            overflow-y: auto;
            padding-left: 20px;
        }

        .main-content {
            padding: 0 30px 50px 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- 3. ç½®é¡¶æœç´¢æ  (ç»ç’ƒæ•ˆæœ) --- */
        .search-container {
            position: sticky;
            top: 0;
            z-index: 50;
            padding: 20px 0;
            /* ç»ç’ƒæ•ˆæœï¼Œä½¿ç”¨èƒŒæ™¯è‰² + é€æ˜åº¦ */
            background: var(--bg-body);
            background: linear-gradient(to bottom, var(--bg-body), var(--bg-body), var(--bg-body), transparent); /* æ¸å˜è®©åº•éƒ¨æ›´æŸ”å’Œ */
            background-color: rgba(255, 255, 255, 0.85); /* æµ…è‰²æ¨¡å¼ä¸‹çš„åŠé€æ˜ */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 8px var(--shadow-base);
            margin: 0 -30px;
            padding: 20px 30px;
        }

        /* æ·±è‰²æ¨¡å¼ä¸‹çš„ç»ç’ƒèƒŒæ™¯è°ƒæ•´ */
        @media (prefers-color-scheme: dark) {
            .search-container {
                background-color: rgba(30, 30, 47, 0.85);
            }
        }

        #search-bar {
            width: 100%;
            padding: 15px 20px;
            border-radius: 12px;
            border: none;
            background-color: var(--bg-container);
            color: var(--text-primary);
            font-size: 16px;
            box-shadow: inset 0 1px 3px var(--shadow-base);
        }
        #search-bar::placeholder {
            color: var(--text-muted);
        }

        /* --- 4. åˆ†ç±»æ ‡é¢˜ --- */
        .category-title {
            font-size: 24px;
            font-weight: 600;
            margin-top: 40px;
            margin-bottom: 25px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
        }

        /* --- 5. é“¾æ¥å¡ç‰‡ç½‘æ ¼ --- */
        .link-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .link-card {
            display: flex;
            align-items: center;
            padding: 18px;
            text-decoration: none;
            border-radius: var(--card-radius);
            background-color: var(--bg-container);
            box-shadow: 0 2px 10px var(--shadow-base);
        }

        .link-card:hover {
            background-color: var(--bg-tertiary);
            transform: translateY(-4px);
            box-shadow: 0 10px 20px var(--shadow-hover), 0 0 10px var(--accent-color);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            object-fit: cover;
            margin-right: 15px;
            background-color: var(--bg-tertiary);
            flex-shrink: 0;
        }

        .card-info { overflow: hidden; }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-desc {
            font-size: 13px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- 6. åº•éƒ¨å’Œæµ®åŠ¨æŒ‰é’® --- */
        .footer {
            text-align: center;
            padding: 30px;
            font-size: 13px;
            color: var(--text-muted);
        }
        .footer a { color: var(--accent-color); text-decoration: none; }

        .edit-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 12px 20px;
            background-color: var(--accent-color);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(93, 93, 255, 0.5);
            z-index: 100;
        }
        .edit-button:hover { transform: scale(1.05); }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                width: 100%;
                height: 50px;
                padding: 0;
                order: -1; /* ç§»åŠ¨åˆ°é¡¶éƒ¨ */
                overflow-x: auto;
                overflow-y: hidden;
                white-space: nowrap;
                border-radius: 0;
                box-shadow: 0 4px 10px var(--shadow-base);
            }
            .logo-area { display: none; }
            .menu-list { display: flex; align-items: center; height: 100%; }
            .menu-link { margin: 0 5px; }

            .main-content-wrapper {
                padding-left: 0;
                margin-top: 50px; /* ä¸ºé¡¶éƒ¨å¯¼èˆªè…¾å‡ºç©ºé—´ */
            }
            .search-container { margin: 0 -20px; padding: 20px; }
            .main-content { padding: 0 20px 50px 20px; }
            .link-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>
<aside class="sidebar">
    <div class="logo-area">
        <img src="../assets/images/logo-collapsed@2x.png" alt="Logo" style="vertical-align: middle;">
        MikuSugar
    </div>

    <ul class="menu-list" id="main-menu">
        <li th:each="site : ${results.sites}">
            <a href="#" class="menu-link smooth-scroll" th:attr="href='#'+ ${site.id}" th:text="${site.id}">åˆ†ç±»åç§°</a>
        </li>
    </ul>
</aside>

<div class="main-content-wrapper">
    <div class="main-content">

        <div class="search-container">
            <input type="text" id="search-bar" placeholder="ğŸ” å¿«é€Ÿæœç´¢ç½‘ç«™åç§°æˆ–æè¿°..." onkeyup="filterLinks()">
        </div>

        <div th:each="site : ${results.sites}">
            <h2 class="category-title" th:id="${site.id}" th:text="${site.id}">åˆ†ç±»æ ‡é¢˜</h2>

            <div class="link-grid" th:id="'grid-' + ${site.id}">
                <a th:each="addr : ${site.siteList}"
                   th:href="${addr.address}"
                   target="_blank"
                   class="link-card search-item"
                   th:data-search="(${addr.name} + ' ' + ${addr.description})">

                    <img th:src="${addr.img}" alt="icon" class="card-icon" onerror="this.src='https://via.placeholder.com/48x48/30314a/a0a0b0?text=I'">

                    <div class="card-info">
                        <div class="card-title" th:text="${addr.name}">ç½‘ç«™åç§°</div>
                        <div class="card-desc" th:text="${addr.description}">è¿™é‡Œæ˜¯ç½‘ç«™çš„ç®€çŸ­æè¿°ä¿¡æ¯...</div>
                    </div>
                </a>
            </div>
        </div>

        <footer class="footer">
            <p id="footer-text"></p>
        </footer>
    </div>
</div>

<a href="https://github.com/MikuSugar/SugarHome/edit/master/src/main/resources/in.json" target="_blank" class="edit-button">
    ç¼–è¾‘æ•°æ®
</a>

<script>
    // 1. è®¾ç½®é¡µè„šå¹´ä»½
    document.getElementById('footer-text').innerHTML = `&copy; ${new Date().getFullYear()} <a href='https://mikusugar.me/' target='_blank'>è¿½èµ¶é£è½¦</a> powered by <a href='https://github.com/WebStackPage/WebStackPage.github.io' target='_blank'>WebStack</a>`;

    // 2. å¹³æ»‘æ»šåŠ¨å’Œä¾§è¾¹æ é«˜äº® (Native JS)
    const mainContentWrapper = document.querySelector('.main-content-wrapper');
    const links = document.querySelectorAll('.smooth-scroll');

    // å¹³æ»‘è·³è½¬
    links.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
            this.classList.add('active');

            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            const searchHeight = document.querySelector('.search-container').offsetHeight;
            const offset = targetElement.offsetTop - searchHeight - 20;

            // ç¡®ä¿åœ¨æ»šåŠ¨åˆ°å†…å®¹åŒº
            mainContentWrapper.scrollTo({
                top: offset,
                behavior: 'smooth'
            });

            // æ‰‹æœºç«¯ç‚¹å‡»åéšè—ä¾§è¾¹æ ï¼ˆå¦‚æœå®ç°çš„è¯ï¼‰
            if (window.innerWidth <= 768) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ é€»è¾‘æ¥å…³é—­æ‰‹æœºç«¯çš„å¯¼èˆªèœå•
            }
        });
    });

    // 3. å®æ—¶æœç´¢è¿‡æ»¤ (æ ¸å¿ƒä¾¿åˆ©æ€§åŠŸèƒ½)
    function filterLinks() {
        const query = document.getElementById('search-bar').value.toLowerCase();
        const items = document.querySelectorAll('.search-item');

        items.forEach(item => {
            const searchData = item.getAttribute('data-search').toLowerCase();
            const categoryElement = item.closest('.link-grid').previousElementSibling; // è·å–çˆ¶åˆ†ç±»æ ‡é¢˜

            if (searchData.includes(query) || query === '') {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });

        // éšè—ç©ºçš„åˆ†ç±»æ ‡é¢˜
        document.querySelectorAll('.link-grid').forEach(grid => {
            const visibleCards = Array.from(grid.children).some(card => card.style.display !== 'none');
            const title = grid.previousElementSibling;
            if (title && title.classList.contains('category-title')) {
                title.style.display = visibleCards ? 'flex' : 'none';
            }
        });
    }

    // 4. é¦–æ¬¡åŠ è½½æ—¶è‡ªåŠ¨é«˜äº®ç¬¬ä¸€ä¸ªèœå•é¡¹
    document.addEventListener('DOMContentLoaded', () => {
        const firstLink = document.querySelector('.menu-link');
        if (firstLink) {
            firstLink.classList.add('active');
        }
    });
</script>
</body>
</html>
